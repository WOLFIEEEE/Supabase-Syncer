# Cursor Rules for Next.js 16 Project

## Project Context
This is a Next.js 16.1.1 application using the App Router, React 19.2.3, TypeScript, and Supabase. Always refer to `NEXTJS_16_DOCUMENTATION.md` for complete Next.js 16 conventions.

## Next.js 16 Critical Rules

### 1. Middleware/Proxy
- **NEVER use `middleware.ts`** - It's deprecated in Next.js 16
- **ALWAYS use `proxy.ts`** at the root level
- Export must be: `export default function proxy(request: NextRequest)`
- File location: `/proxy.ts` (root directory)
- Reference: See `NEXTJS_16_DOCUMENTATION.md` section "Middleware → Proxy Migration"

### 2. File Conventions (App Router)
- **Pages**: Use `page.tsx` (not `page.js`) - located in `app/[route]/page.tsx`
- **Layouts**: Use `layout.tsx` - must export default component with `children: React.ReactNode`
- **API Routes**: Use `route.ts` - export named functions: `GET`, `POST`, `PUT`, `PATCH`, `DELETE`
- **Loading States**: Use `loading.tsx` for loading UI
- **Error Boundaries**: Use `error.tsx` with `'use client'` directive
- **Not Found**: Use `not-found.tsx` for 404 pages

### 3. Route Groups
- Use parentheses for organization: `(auth)`, `(dashboard)`, `(public)`
- Route groups do NOT affect URL structure
- Each route group can have its own `layout.tsx`
- Example: `app/(auth)/login/page.tsx` → URL is `/login` (not `/auth/login`)

### 4. Server vs Client Components
- **Default to Server Components** - No directive needed
- **Add `'use client'`** only when:
  - Using React hooks (`useState`, `useEffect`, etc.)
  - Using browser APIs (`window`, `document`, `localStorage`)
  - Using event handlers (`onClick`, `onChange`)
  - Using third-party client-side libraries
- **Composition Pattern**: Server components fetch data, pass to client components as props

### 5. API Routes Structure
```typescript
// app/api/[route]/route.ts
import { NextRequest, NextResponse } from 'next/server';

export async function GET(request: NextRequest) {
  return NextResponse.json({ data: 'value' });
}

export async function POST(request: NextRequest) {
  const body = await request.json();
  return NextResponse.json({ success: true });
}
```

### 6. Special Files
- **Favicon**: Prefer `app/favicon.ico` over `public/favicon.ico`
- **Robots**: Use `app/robots.ts` returning `MetadataRoute.Robots`
- **Sitemap**: Use `app/sitemap.ts` returning `MetadataRoute.Sitemap`
- **Metadata**: Export `metadata` object from `layout.tsx` or `page.tsx`

### 7. TypeScript Conventions
- Use TypeScript for all new files (`.ts`, `.tsx`)
- Use proper types from `next/server`: `NextRequest`, `NextResponse`
- Use `Metadata` type from `next` for metadata exports
- Use `React.ReactNode` for children props

## Project-Specific Rules

### File Structure
```
app/
  (auth)/              # Route group for authentication
  (dashboard)/         # Route group for dashboard
  (public)/            # Route group for public pages
  api/                 # API routes
  [other routes]/      # Regular routes
  layout.tsx           # Root layout (REQUIRED)
  page.tsx             # Home page
  favicon.ico          # Favicon
  robots.ts            # Robots.txt generator
  sitemap.ts           # Sitemap generator
  globals.css           # Global styles
  providers.tsx        # Context providers

components/            # React components
  ui/                  # Reusable UI components
  [feature]/           # Feature-specific components

lib/                   # Library code
  services/            # Business logic services
  utils/               # Utility functions
  db/                  # Database code
  supabase/            # Supabase utilities
  middleware/          # Middleware utilities (NOT proxy.ts)
  validations/         # Validation schemas

public/                # Static assets
scripts/               # Utility scripts
supabase/              # Supabase migrations
types/                 # TypeScript types
tests/                 # Test files
```

### Code Style
- Use named exports for utilities and services
- Use default exports for pages, layouts, and components
- Use `@/` alias for imports (configured in `tsconfig.json`)
- Prefer async/await over promises
- Use TypeScript strict mode

### API Route Patterns
- All API routes must be in `app/api/` directory
- Use `route.ts` file naming
- Export HTTP method functions: `GET`, `POST`, `PUT`, `PATCH`, `DELETE`
- Use `NextRequest` and `NextResponse` types
- Handle errors properly with try/catch
- Return appropriate HTTP status codes

### Component Patterns
- Server Components: Fetch data directly, no `'use client'`
- Client Components: Add `'use client'` at the top, use hooks
- Shared Components: Place in `components/` directory
- Feature Components: Group in `components/[feature]/`

### Error Handling
- Use `error.tsx` for error boundaries (must be client component)
- Use try/catch in API routes
- Return proper error responses: `NextResponse.json({ error: 'message' }, { status: 400 })`

### Security
- Use `proxy.ts` for authentication checks
- Set security headers in `proxy.ts` or `next.config.ts`
- Validate input in API routes using Zod schemas
- Use environment variables for secrets (never commit `.env` files)

### Performance
- Use `loading.tsx` for better UX
- Implement proper caching strategies
- Use Server Components by default
- Only use Client Components when necessary
- Leverage route groups for code splitting

## Common Patterns

### Server Component with Data Fetching
```typescript
// app/users/page.tsx
import { db } from '@/lib/db';

export default async function UsersPage() {
  const users = await db.users.findMany();
  
  return (
    <div>
      {users.map(user => (
        <div key={user.id}>{user.name}</div>
      ))}
    </div>
  );
}
```

### Client Component with Interactivity
```typescript
// components/Counter.tsx
'use client';

import { useState } from 'react';

export default function Counter() {
  const [count, setCount] = useState(0);
  
  return (
    <button onClick={() => setCount(count + 1)}>
      Count: {count}
    </button>
  );
}
```

### API Route with Validation
```typescript
// app/api/users/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { z } from 'zod';

const schema = z.object({
  name: z.string().min(1),
  email: z.string().email(),
});

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const data = schema.parse(body);
    
    // Process data...
    
    return NextResponse.json({ success: true }, { status: 201 });
  } catch (error) {
    return NextResponse.json(
      { error: 'Invalid input' },
      { status: 400 }
    );
  }
}
```

### Metadata Export
```typescript
// app/page.tsx or app/layout.tsx
import { Metadata } from 'next';

export const metadata: Metadata = {
  title: 'Page Title',
  description: 'Page description',
};
```

## What NOT to Do

1. ❌ **Don't use `middleware.ts`** - Use `proxy.ts` instead
2. ❌ **Don't put `'use client'` everywhere** - Only when needed
3. ❌ **Don't create empty directories** - Remove unused route folders
4. ❌ **Don't mix Server and Client component patterns** - Be explicit
5. ❌ **Don't use `getServerSideProps` or `getStaticProps`** - App Router doesn't use these
6. ❌ **Don't put API logic in pages** - Use API routes in `app/api/`
7. ❌ **Don't commit build artifacts** - `.next/`, `tsconfig.tsbuildinfo`, etc.
8. ❌ **Don't use Pages Router patterns** - This is App Router only

## When Creating New Files

1. **New Page**: Create `app/[route]/page.tsx` with default export
2. **New API Route**: Create `app/api/[route]/route.ts` with HTTP method exports
3. **New Component**: Create in `components/` with appropriate `'use client'` if needed
4. **New Service**: Create in `lib/services/` with named exports
5. **New Utility**: Create in `lib/utils/` with named exports
6. **New Type**: Create in `types/` or inline with proper TypeScript types

## Testing Considerations

- Test Server Components with async data fetching
- Test Client Components with React Testing Library
- Test API routes with proper request/response mocking
- Test error boundaries with `error.tsx`
- Test loading states with `loading.tsx`

## References

- **Next.js 16 Documentation**: See `NEXTJS_16_DOCUMENTATION.md` for complete details
- **Official Docs**: https://nextjs.org/docs
- **App Router**: https://nextjs.org/docs/app
- **API Reference**: https://nextjs.org/docs/app/api-reference

## Important Notes

- This project uses Next.js 16.1.1 with App Router
- React 19.2.3 is required
- Node.js 20.9.0+ is required
- TypeScript 5.1.0+ is required
- Turbopack is the default bundler
- Always follow Next.js 16 conventions, not older versions


